<div class="row">
  <div class="col-md-8 mx-auto">
    <h3 class="my-3">
      課程名稱：{{#if course.name}}{{course.name}}{{else}}尚未建立{{/if}}</h3>

    <h3 class="my-3">Step 2</h3>
    <h4 class="my-3">已建立的章節：{{#if lessons}}{{else}}尚未建立{{/if}}</h4 class="my-3">

    {{!-- 建立可拖曳的 ul > li --}}
    <div class="row">
      <div class="col mx-auto">
        <ul class="connected-sortable droppable-area1 courses-tbody w-100" data-courseid="{{course.id}}">
          {{#each lessons}}
          <li class="draggable-item mb-2 py-2 d-flex justify-content-between">
            <span class="w-25">章節 {{this.lessonNumber}}</span>
            <input class="d-none input-lessonnumber" type="text" data-pk="{{this.id}}" data-courseid="{{this.CourseId}}"
              name="lessonNumber" value="{{this.lessonNumber}}">
            {{this.title}}
            <div class="list-btn-group">
              {{!-- <form action="/courses/create/{{../course.id}}/step2/{{this.id}}_method=DELETE" method="post"> --}}
              <a href="/courses/create/{{../course.id}}/step2/{{this.id}}/edit"
                class="btn btn-link btn-sm my-0 text-primary mr-2">Edit
              </a>
              {{!-- 刪除鈕動作改以 jquery 執行 --}}
              <button class="btn btn-link btn-sm my-0 text-danger btn-remove-lesson" role="" data-id="{{this.id}}"
                data-lessonnumber="{{this.lessonNumber}}">Remove
              </button>
              {{!-- </form> --}}
            </div>
          </li>
          {{/each}}
        </ul>
        <button class="btn btn-outline-primary btn-add-lesson" type="submit">Add lesson</button>
        <small class="ml-2 text-muted">建立章節名稱</small>
      </div>
    </div>


    {{#if lesson}}
    <div class="d-flex justify-content-start mt-5">
      <a href="/courses/create/{{course.id}}/step2" class="btn btn-primary my-3 mr-5 text-white">建立新的章節<i
          class="fas fa-plus ml-3"></i>
      </a>
    </div>
    {{/if}}


    {{#if lesson}}
    <h3 class="mt-3">編輯章節內容</h3>
    <form action="/courses/create/{{course.id}}/step2/{{lesson.id}}?_method=PUT" method="POST" class="mt-5"
      id="identifier">
      <div class="form-group">
        <label for="name">課程章節</label>
        <input type="number" class="form-control " name="lessonNumber" id="lessonNumber" placeholder=""
          value="{{lesson.lessonNumber}}" readonly>
      </div>
      <div class="form-group">
        <label for="title">章節名稱</label>
        <input type="text" class="form-control" name="title" id="title" placeholder="" value="{{lesson.title}}">
      </div>
      <div class="form-group">
        <label for="intro">章節簡介</label>
        <input type="text" class="form-control" name="intro" id="intro" placeholder="" value="{{lesson.intro}}">
      </div>
      <div class="form-group">
        <label for="totalTime">章節上課時數 ( 分鐘 )</label>
        <input type="number" class="form-control" name="totalTime" id="totalTime" placeholder=""
          value="{{lesson.totalTime}}">
      </div>
      <div class="form-group mb-0">
        <label for="totalTime">是否提供未購買者預覽</label>
      </div>
      <div class="form-check ml-4">
        <input class="form-check-input" type="radio" name="isPreview" id="isPreview1" value="false" checked>
        <label class="form-check-label" for="isPreview1">
          不提供給未購買者預覽
        </label>
      </div>
      <div class="form-group ml-4">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="isPreview" id="isPreview2" value="true">
          <label class="form-check-label" for="isPreview2">
            提供未購買者預覽
          </label>
        </div>
      </div>
      <div class="form-group">
        <label for="videoURL">影片連結</label>
        <input type="text" class="form-control" name="videoURL" id="videoURL" placeholder=""
          value="{{lesson.videoURL}}">
      </div>
      <div class="form-group purple-border">
        <label for="contents">編輯課程內容</label>
        {{!-- rich text editor --}}
        <!-- Create toolbar container -->
        <div id="toolbar"></div>
        <div id="editor" style="height: 300px;">{{{lesson.contents}}}</div>

        {{!-- 編輯在 #editor 中的內容，於送出 request 後會先把編輯內容存進 textarea，再 submit--}}
        <textarea name="contents" class="form-control" style="display:none" id="hiddenArea"></textarea>

      </div>
      <button type="submit" class="btn btn-primary mr-5 text-white">Save</button>
    </form>

    {{else}}
    <h3 class="mt-5">建立新的章節</h3>
    <form action="/courses/create/{{course.id}}/step2" method="POST" class="mt-4" id="identifier">
      <div class="form-group">
        <label for="name">課程章節</label>
        <input type="number" class="form-control" name="lessonNumber" id="lessonNumber" placeholder=""
          value="{{lesson.lessonNumber}}">
      </div>
      <div class="form-group">
        <label for="title">章節名稱</label>
        <input type="text" class="form-control" name="title" id="title" placeholder="" value="{{lesson.title}}">
      </div>
      <div class="form-group">
        <label for="intro" class="mr-5">章節簡介 (50 字為限)</label>
        <small class="ml-5 text-muted">剩餘字數</small>
        <small class="ml-1 text-muted" id="intro-small"></small>
        <textarea class="form-control" maxlength="50" rows="2" name="intro" id="intro"
          placeholder="簡單介紹課程內容...">{{lesson.intro}}</textarea>
      </div>
      <div class="form-group">
        <label for="totalTime">章節上課時數 ( 分鐘 )</label>
        <input type="number" class="form-control" name="totalTime" id="totalTime" placeholder=""
          value="{{lesson.totalTime}}">
      </div>
      <div class="form-group mb-0">
        <label for="totalTime">是否提供未購買者預覽</label>
      </div>
      <div class="form-check ml-4">
        <input class="form-check-input" type="radio" name="isPreview" id="isPreview1" value="false" checked>
        <label class="form-check-label" for="isPreview1">
          不提供給未購買者預覽
        </label>
      </div>
      <div class="form-group ml-4">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="isPreview" id="isPreview2" value="true">
          <label class="form-check-label" for="isPreview2">
            提供未購買者預覽
          </label>
        </div>
      </div>
      <div class="form-group">
        <label for="videoURL">影片連結</label>
        <input type="text" class="form-control" name="videoURL" id="videoURL" placeholder=""
          value="{{lesson.videoURL}}">
      </div>
      <div class="form-group purple-border">
        <label for="contents">編輯課程內容</label>
        {{!-- rich text editor --}}
        <!-- Create toolbar container -->
        <div id="toolbar"></div>
        <progress id='progressbar' style='display: none' value="0"></progress>
        <div id="editor" style="height: 300px;">
          {{{lesson.contents}}}
        </div>

        <textarea name="contents" class="form-control" style="display:none" id="hiddenArea"></textarea>

      </div>
      <button type="submit" class="btn btn-primary mr-5 text-white">Save</button>
    </form>
    {{/if}}

    <div class="d-flex justify-content-start mt-3 mb-5">
      <a href="/courses/create/{{course.id}}/step1" class="btn btn-outline-info my-3 mr-5">上一步
      </a>

      <a href="/courses/create/{{course.id}}/step3" class="btn btn-outline-info my-3">下一步
      </a>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
  //課程簡介輸入區-剩餘字數判斷
  const introSmall = $('#intro-small')
  const introInput = $('#intro')
  let introLetterLeft = 50 - introInput.val().length
  introSmall.text(introLetterLeft)
  $('#intro').keyup(function () {
    console.log(introInput.val().length)
    introLetterLeft = 50 - introInput.val().length
    introSmall.text(introLetterLeft)
  })

</script>